---
import MinimalMarketingLayout from "#www/layouts/MinimalMarketingLayout.astro"
import { Navbar } from "#www/components/Navbar"
import { Footer } from "#www/components/Footer"
import { getCollection, render } from "astro:content"

export const prerender = true

export async function getStaticPaths() {
	let posts = await getCollection("blog")
	let enPosts = posts.filter(post => post.id.endsWith("/en"))

	return enPosts.map(post => ({
		params: { slug: post.id.replace("/en", "") },
		props: { post },
	}))
}

let { post } = Astro.props
if (!post) {
	throw new Error(`Post not found in props. Slug: ${Astro.params.slug}`)
}
let { Content } = await render(post)
---

<MinimalMarketingLayout
	title={post.data.title}
	description={post.data.description}
	ogImage={post.data.ogImage}
>
	<Navbar
		locale="en"
		client:load
		logo={{
			text: "Tilly",
			href: "/en/",
		}}
		navigation={[
			{ name: "Features", href: "/en/#features" },
			{ name: "Experience", href: "/en/#experience" },
			{ name: "FAQ", href: "/en/#faq" },
			{ name: "Blog", href: "/en/blog" },
		]}
		cta={{
			text: "Go to App",
			href: "/app",
		}}
		languages={[
			{ name: "English", href: `/en/blog/${post.id.replace("/en", "")}` },
			{ name: "Deutsch", href: `/de/blog/${post.id.replace("/en", "")}` },
		]}
	/>

	<main class="container mx-auto px-6 py-12 md:px-8 md:py-24">
		<article class="prose prose-lg dark:prose-invert mx-auto max-w-3xl">
			<div class="not-prose mb-8">
				<a
					href="/en/blog"
					class="text-muted-foreground hover:text-foreground mb-4 inline-block text-sm transition-colors"
				>
					‚Üê Back to blog
				</a>
				<h1 class="text-4xl font-bold tracking-tight md:text-5xl">
					{post.data.title}
				</h1>
				<p class="text-muted-foreground mt-4 text-lg">
					{post.data.description}
				</p>
				<div class="mt-4 flex items-center gap-4 text-sm">
					<time class="text-muted-foreground">
						{post.data.pubDate}
					</time>
					<div class="flex gap-2">
						{post.data.tags.map(tag => (
							<span class="bg-muted text-muted-foreground rounded px-2 py-1 text-xs">
								{tag}
							</span>
						))}
					</div>
				</div>
				<div class="mt-6 flex items-center gap-3 border-t pt-6">
					<img
						src={post.data.author.avatar}
						alt={post.data.author.name}
						class="h-12 w-12 rounded-full object-cover"
					/>
					<div>
						<p class="font-medium">
							{post.data.author.name}
						</p>
						<p class="text-muted-foreground text-sm">
							{post.data.author.role}
						</p>
					</div>
				</div>
			</div>

			<Content />
		</article>
	</main>

	<Footer
		navigation={{
			main: [
				{ name: "Features", href: "/en/#features" },
				{ name: "Experience", href: "/en/#experience" },
				{ name: "FAQ", href: "/en/#faq" },
				{ name: "Blog", href: "/en/blog" },
				{ name: "Imprint", href: "/en/imprint" },
				{ name: "Privacy", href: "/en/privacy" },
			],
			social: [
				{
					name: "Twitter",
					href: "https://twitter.com/tillydotsocial",
					icon: "Twitter",
				},
				{
					name: "Instagram",
					href: "https://instagram.com/tilly.social",
					icon: "Instagram",
				},
				{
					name: "GitHub",
					href: "https://github.com/ccssmnn/tilly",
					icon: "Github",
				},
			],
			languages: [
				{ name: "English", href: "/en/blog" },
				{ name: "Deutsch", href: "/de/blog" },
			],
		}}
		company={{
			name: "Tilly",
		}}
	/>
</MinimalMarketingLayout>
